@Inject
======
Code injection is to "insert" your codes to a certain place of a certain vanilla method.

Here, let's take ```ServerPlayer``` as an example.

Basic
-----

### Determine Your Purpose

In this example, you use Mixin to send the player a message when hurt.

:::caution
A more recommended approach is to listen to ```LivingHurtEvent``` and send the message on the event. Such an event can provide you with the specific player instance, while Mixin applies the codes to the class and all instances.
:::

### Find Target Methods

You can find a method called ```hurt``` in ```ServerPlayer``` class, which takes two parameters: a ```DamageSource``` and a float indicates the amount.

```java
public boolean hurt(DamageSource p_9037_, float p_9038_){
	...
}
```

### Mixin Method

Copy the method with the name and parameters to your mixin class. You can change the method and parameter names in the mixin class but do not change the parameter types and sequence.

Add an additional parameter to this method, which depends on the return value. If the method is void then add ```CallbackInfo```. If the method returns a value then add ```CallbackInfoReturnable<ReturnType>```.

Change the return type of the method to void.

Add and complete the annotation ```@Inject``` Basically, it takes two parameters. ```method``` is the target method, and ```at``` is the injection position. The most common injection position is ```HEAD```, ```TAIL```, and ```RETURN```. The details can be found in the documents of Mixin.

### Mixin Codes
Then you can complete the codes in the mixin method, just like you are writing codes at the head of the vanilla method ```hurt```.

However, the mixin method is in the mixin class and ```this``` refers to the mixin instance but not the player instance. So you can use a trick to get the "this" player instance. Cast ```this``` to ```Object``` and then ```ServerPlayer```. It may seem strange elsewhere, but it is normal in Mixin.

Therefore, the complete method can be like this
```java
@Inject(method = {"hurt"}, at = {@At("HEAD")})
public void onPlayerHurt(DamageSource source, float value, CallbackInfoReturnable<Boolean> ci){
    ServerPlayer self = (ServerPlayer) (Object) this;
    self.sendSystemMessage(Component.literal("Ouch!"));
}

```

Save codes and run the game. You will receive the message every time you get hurt.

:::tip
To inject into non-parameterized constructors, or there is only one constructor no matter parameterized or non-parameterized, the method should be ```method = {"<init>"}```, but not ```method = {"init"}```.  

To inject into parameterized ones, the method name will be discussed later.

To inject into all constructors, the method should be ```method = {"<init>*"}```.

The injection position of constructors can only be ```at = {@At("TAIL")}``` or ```at = {@At("RETRN")}```.

To inject into static blocks, the method should be ```method = {"<clinit>"}```
:::

Advanced
--------

Sometimes there can be method overloading. Several methods with different parameter types have the same name. Such as ```sendSystemMessage(Component)``` and ```sendSystemMessage(Component, boolean)```

In this situation, you should explicitly designate the method name and descriptor. Accordingly, the parameters of their mixin methods are also different.

you should use this for the former one

```java
@Inject(method = {"sendSystemMessage(Lnet/minecraft/network/chat/Component;)V"}, at = {@At("HEAD")})
public void onSendMessage(Component p_215097_, CallbackInfo ci){
    ...
}
```

and this for the latter one: 

```java
@Inject(method = {"sendSystemMessage(Lnet/minecraft/network/chat/Component;Z)V"}, at = {@At("HEAD")})
public void onSendMessage(Component p_215097_, boolean p_240545_, CallbackInfo ci){
    ...
}
```

:::tip
For overloaded constructors, the name is always ```method = {"<init>(...)V"}```. What you need to edit is the parameter type in (). 
:::

Here is a table of type descriptors, which is found in [Oracle's document][doc]. You can also find ways to complete method descriptors in that document.

| FieldType term | Type      | Interpretation                                                                    |
|----------------|-----------|-----------------------------------------------------------------------------------|  
| B              | byte      | signed byte                                                                       |
| C              | char      | Unicode character code point in the Basic Multilingual Plane, encoded with UTF-16 |
| D              | double    | double-precision floating-point value                                             |
| F              | float     | single-precision floating-point value                                             |
| I              | int       | int	integer                                                                      |
| J              | long      | long integer                                                                      |
| L ClassName ;  | reference | an instance of class ClassName                                                    |
| S              | short     | signed short                                                                      |
| Z              | boolean   | true or false                                                                     |
| [              | reference | one array dimension                                                               |



[doc]: https://docs.oracle.com/javase/specs/jvms/se14/html/jvms-4.html#jvms-4.3.2
